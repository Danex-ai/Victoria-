<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My apology</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  height:100vh;
  overflow:hidden;
  font-family:Arial,sans-serif;
  /* Background with subtle dark radial & linear overlays */
  background:
    radial-gradient(circle at center, rgba(0,0,0,0.35) 0%, rgba(0,0,0,0.65) 55%, rgba(0,0,0,0.85) 100%),
    linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.65)),
    url("bg.jpg");
  background-position: center top;
  background-size: cover;
  background-repeat: no-repeat;
}

/* MAIN CANVAS */
#canvas{position:relative;width:100%;height:100%;}

/* HEART ROSE */
.rose{
  position:absolute;
  width:40px;
  height:40px;
  transform:translate(-50%,-50%);
  pointer-events:none;
  filter:drop-shadow(0 0 6px rgba(255,111,145,.55));
  z-index:2;
}
.rose svg{width:100%;height:100%;}

/* FALLING ROSES */
.falling-rose{
  position:absolute;
  top:-50px;
  width:26px;
  height:26px;
  pointer-events:none;
  animation:fall linear forwards;
  z-index:3;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);opacity:0}
}

/* LOVE TEXT */
.love-text-container{
  position:absolute;
  bottom:26%;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  opacity:0;
  transition:opacity 2s;
  z-index:5;
}
.love-text-container.show{opacity:1}

.letter-rose{
  width:40px;
  height:40px;
  animation:pulse 2s infinite;
  position:relative;
}
@keyframes pulse{50%{transform:scale(1.15)}}

/* APOLOGY BOX */
.apology{
  position:absolute;
  bottom:6%;
  left:50%;
  transform:translateX(-50%);
  max-width:92%;
  padding:18px 20px;
  background:rgba(10,10,10,0.65);
  backdrop-filter:blur(6px);
  color:#f2f2f2;
  border-radius:18px;
  text-align:center;
  font-size:14px;
  line-height:1.9;
  box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05);
  opacity:0;
  z-index:10;
}
.apology.show{opacity:1}

#typewriter{color:#f5f5f5;}
#typewriter::after{content:"|";animation:blink 1s infinite;}
@keyframes blink{50%{opacity:0}}

/* MOBILE */
@media(max-width:480px){
  .letter-rose{width:34px;height:34px}
  .apology{font-size:13px}
}
</style>
</head>

<body>
<div id="canvas">
  <div class="love-text-container" id="loveText"></div>
  <div class="apology" id="apologyBox">
    <span id="typewriter"></span>
  </div>
</div>

<!-- MUSIC -->
<audio id="bgMusic" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("canvas");
const loveText = document.getElementById("loveText");
const apologyBox = document.getElementById("apologyBox");
const typeTarget = document.getElementById("typewriter");
const music = document.getElementById("bgMusic");

let centerX = innerWidth/2, centerY = innerHeight/2;
window.onresize = () => { centerX = innerWidth/2; centerY = innerHeight/2; };

/* ROSE SVG */
function roseSVG(c1,c2){
  return `
  <svg viewBox="0 0 100 100">
    <ellipse cx="50" cy="40" rx="18" ry="25" fill="${c1}"/>
    <ellipse cx="35" cy="47" rx="18" ry="25" fill="${c1}" transform="rotate(-45 35 47)"/>
    <ellipse cx="65" cy="47" rx="18" ry="25" fill="${c1}" transform="rotate(45 65 47)"/>
    <circle cx="50" cy="55" r="8" fill="${c2}"/>
  </svg>`;
}

/* HEART PATH */
function heartPoints(size){
  let p=[];
  for(let i=0;i<=260;i++){
    let t=i/260*Math.PI*2;
    let x=size*16*Math.sin(t)**3;
    let y=-size*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    p.push({x:centerX+x,y:centerY+y});
  }
  return p;
}

/* DRAW HEART */
function drawHeart(size,c1,c2,delay,speed){
  setTimeout(()=>{
    let pts=heartPoints(size),i=0;
    let r=document.createElement("div");
    r.className="rose";
    r.innerHTML=roseSVG(c1,c2);
    canvas.appendChild(r);
    (function step(){
      if(i>=pts.length) return r.remove();
      r.style.left=pts[i].x+"px";
      r.style.top=pts[i].y+"px";
      i++;setTimeout(step,speed);
    })();
  },delay);
}

[
 [3,"#ff6f91","#ff3d68",0,14],
 [5,"#ff6f91","#ff3d68",4000,12],
 [7,"#ff6f91","#ff3d68",8000,10]
].forEach(h=>drawHeart(...h));

/* LOVE TEXT */
setTimeout(()=>{
  ["I","AM","SORRY","VICTORIA","❤"].forEach(w=>{
    let d=document.createElement("div");
    d.className="letter-rose";
    d.innerHTML=roseSVG("#ff6f91","#ff3d68");

    let t=document.createElement("div");
    t.textContent=w;
    Object.assign(t.style,{
      position:"absolute",
      top:"50%",
      left:"50%",
      transform:"translate(-50%,-50%)",
      color:"#ffe6ec",
      fontWeight:"bold"
    });

    d.appendChild(t);
    loveText.appendChild(d);
  });
  loveText.classList.add("show");
},16000);

/* TYPEWRITER + MUSIC + ROSE RAIN */
const apologyText =
"Victoria, I’m truly sorry. " +
"I never meant to hurt you or make you feel disrespected. " +
"I should have been more careful, especially knowing she’s your friend. " +
"You genuinely matter to me, and I hope one day we can talk and heal this together. ❤️";

let idx=0;

function fadeInMusic(){
  music.volume=0;
  music.play().catch(()=>{});
  let v=0;
  let f=setInterval(()=>{
    if(v>=0.4) return clearInterval(f);
    v+=0.02; music.volume=v;
  },300);
}

function dropRose(){
  let r=document.createElement("div");
  r.className="falling-rose";
  r.style.left=Math.random()*innerWidth+"px";
  r.style.animationDuration=5+Math.random()*3+"s";
  r.innerHTML=roseSVG("#ff6f91","#ff3d68");
  canvas.appendChild(r);
  setTimeout(()=>r.remove(),8000);
}

function startExperience(){
  apologyBox.classList.add("show");
  fadeInMusic();
  let rain=setInterval(dropRose,600);
  let type=setInterval(()=>{
    typeTarget.textContent+=apologyText[idx++];
    if(idx>=apologyText.length){
      clearInterval(type);
      clearInterval(rain);
    }
  },45);
}

/* MOBILE AUDIO FIX: starts on first tap */
document.body.addEventListener("click", ()=>{
  startExperience();
},{ once:true });

</script>
</body>
</html>
